(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2586],{53326:function(e,t,n){Promise.resolve().then(n.bind(n,2099))},2099:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Y}});var r=n(27573),a=n(91014),o=n(5891),s=n(67754),i=n(93456),l=n(57851),c=n(42443),u=n(88075),d=n(92068);function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let n=Math.ceil(t/2);return"".concat(e.substring(0,n),"\n\n  [...]\n\n  ").concat(e.substring(e.length-n))}var f=n(7653),p=n(27920),h=n(44768),v=n(17299),x=n(41464),g=n(2275),y=n(74293),_=n(95950),w=n(51087),j=n(24038),b=n(21468),E=n(20504),C=n(44846),N=n(22623),S=n(6141);let T=e=>"".concat(e.serverName,"-").concat(e.name);var k=n(11096),A=n(74651),M=n(67736),z=n(72500),D=n(57908),I=n(93124),R=n(59679),U=n(70318);function O(e){let{isModalOpen:t,currentTool:n,currentToolInput:a,handleDeny:o,handleAllow:s,handleAlwaysAllow:i}=e,[l,c]=(0,f.useState)(!1);return(0,r.jsxs)(A.u_,{isOpen:t,onClose:()=>o(),title:(0,r.jsx)("div",{className:"text-sm",children:(0,r.jsx)(I.Z,{defaultMessage:'Allow tool from "{serverName}" (local)?',id:"qFw7KhHY68",values:{serverName:null==n?void 0:n.serverName}})}),children:[(0,r.jsxs)("div",{className:"text-xs my-2 bg-bg-300 rounded-md px-2 py-1",children:[(0,r.jsxs)("button",{onClick:()=>c(!l),className:"flex justify-between items-center w-full text-[0.625rem] text-text-000 font-medium transition-colors duration-200 hover:text-text-300",children:[(0,r.jsx)("div",{children:(0,r.jsx)(I.Z,{defaultMessage:"Run {toolName} from {serverName}",id:"6/XY9VpX3Z",values:{toolName:null==n?void 0:n.name,serverName:null==n?void 0:n.serverName}})}),(0,r.jsx)(M.p,{className:(0,D.Z)("transform transition-transform duration-300 ease-in-out",l?"rotate-0":"-rotate-90"),size:12})]}),(0,r.jsxs)("div",{className:(0,D.Z)("overflow-hidden transition-all duration-500 ease-in-out",l?"max-h-screen opacity-100":"max-h-0 opacity-0"),children:[(null==n?void 0:n.description)&&(0,r.jsx)("div",{className:"mt-2 mb-1",children:null==n?void 0:n.description}),a&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("div",{className:"text-[0.625rem] text-text-400 mb-1",children:(0,r.jsx)(I.Z,{defaultMessage:"Tool Input:",id:"zye//zQc25"})}),(0,r.jsx)(R.Z,{language:"json",style:U.Z,className:"rounded !text-xs !p-2",children:JSON.stringify(JSON.parse(a),null,2)})]})]})]}),(0,r.jsxs)("p",{className:"text-[0.625rem] text-text-300 flex gap-1.5 items-center",children:[(0,r.jsx)(z.v,{size:"18px"}),(0,r.jsx)("span",{children:(0,r.jsx)(I.Z,{defaultMessage:"Malicious MCP servers or conversation content could potentially trick Claude into attempting harmful actions through your installed tools. <bold>Review each action carefully before approving.</bold>",id:"GCRi+qB/iA",values:{bold:e=>(0,r.jsx)("span",{className:"font-medium",children:e})}})})]}),(0,r.jsxs)("div",{className:"flex justify-between mt-3 text-sm",children:[(0,r.jsxs)("div",{children:[i&&(0,r.jsx)(k.z,{onClick:i,size:"sm",variant:"outline",className:"mr-2",children:(0,r.jsx)(I.Z,{defaultMessage:"Allow for This Chat",id:"E3y1M9HTd6"})}),(0,r.jsx)(k.z,{onClick:s,size:"sm",variant:"outline",children:(0,r.jsx)(I.Z,{defaultMessage:"Allow Once",id:"d+Xd7eN3T+"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)(k.z,{size:"sm",onClick:o,children:(0,r.jsx)(I.Z,{defaultMessage:"Deny",id:"htvX+Z11l+"})})})]})]})}function Z(e){var t,n;let{conversationTitle:o,conversationUUID:i,isLoadingHarmony:y,chatInputDefaultMessage:_}=e,{currentPath:w,data:k,isLoading:A,isPlaceholderData:M}=(0,a._C)(i,{suppressError:!0}),{changeDisplayedConversationPath:z}=(0,h.p)(),{mcpTools:D}=(0,l.c)(),{onInvokeTool:I,isModalOpen:R,currentTool:U,currentToolInput:Z,handleAllow:P,handleDeny:Y,handleAlwaysAllow:H}=function(e){let{conversationUUID:t,mcpTools:n}=e,r=(0,S.Q)(),{track:a}=(0,b.z$)(),[o,s]=(0,f.useState)(!1),[i,l]=(0,f.useState)(null),[c,u]=(0,f.useState)(null),[d,m]=(0,f.useState)(null),[p,h]=(0,E.A)("alwaysAllowTools-".concat(t),{}),v=(0,f.useRef)(p),x=(0,f.useCallback)(async(e,t,a,o,i)=>{let c=n.find(e=>e.name===t);if(!c)return r(e,t,a,o,i);if("dolphin"===t){var d;let n=(d=(0,N.I)(o))&&"object"==typeof d?"actions"in d&&Array.isArray(d.actions)?d.actions.map(e=>({type:e.action,state:"pending",coordinate:"coordinate"in e?e.coordinate:void 0,start_coordinate:"start_coordinate"in e?e.start_coordinate:void 0,text:"text"in e?e.text:void 0,scroll_direction:"scroll_direction"in e?e.scroll_direction:void 0,scroll_amount:"scroll_amount"in e?e.scroll_amount:void 0,duration:"duration"in e?e.duration:void 0})):"action"in d?[{type:d.action,state:"pending",coordinate:"coordinate"in d?d.coordinate:void 0,start_coordinate:"start_coordinate"in d?d.start_coordinate:void 0,text:"text"in d?d.text:void 0,scroll_direction:"scroll_direction"in d?d.scroll_direction:void 0,scroll_amount:"scroll_amount"in d?d.scroll_amount:void 0,duration:"duration"in d?d.duration:void 0}]:[]:[];if(1===n.length&&"screenshot"===n[0].type)return r(e,t,a,o,i);if(n.length>0)return new Promise(e=>{l(c),u(a),m(o),e()})}let f=v.current[T(c)];return(null==f?void 0:f.allowed)?r(e,t,a,o,i):new Promise(e=>{l(c),u(a),m(o),s(!0),e()})},[r,n]),g=(0,f.useCallback)(()=>{s(!1),i&&null!==c&&null!==d&&r(t,i.name,c,d)},[t,i,c,d,r]),y=(0,f.useCallback)(()=>{if(s(!1),i&&null!==c&&null!==d){var e;r(t,i.name,c,d,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),a({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!==(e=(0,N.I)(d))&&void 0!==e?e:{}).length})}},[t,i,c,d,r,a]),{value:_}=(0,C.F)("claude_ai_allow_tool_always_allow"),w=(0,f.useCallback)(()=>{_&&(i&&h(e=>{let t={...e,[T(i)]:{allowed:!0,lastUpdated:Date.now()}};return v.current=t,t}),s(!1),i&&null!==c&&null!==d&&r(t,i.name,c,d))},[t,i,c,d,r,h,_]);return{onInvokeTool:x,isModalOpen:o,currentTool:i,currentToolInput:d,handleAllow:g,handleDeny:y,handleAlwaysAllow:_?w:void 0}}({conversationUUID:i,mcpTools:D}),{value:K}=(0,c.h)(null!==(t=null==k?void 0:k.settings)&&void 0!==t?t:{}),J=(0,f.useCallback)(()=>{let e=D.map(e=>{var t;return{name:e.name,description:null!==(t=e.description)&&void 0!==t?t:e.name,input_schema:e.inputSchema}});return K&&(e.push({type:"artifacts_v0",name:"artifacts"}),e.push({type:"repl_v0",name:"repl"})),e},[D,K]),[Q,X]=(0,f.useState)(),q=(0,f.useCallback)(e=>{X(e)},[X]),L=(0,p.pV)(i,I,J),B=(0,p.lE)(i,I,J,Q),{mutate:F}=(0,a.jl)(i),V=L.isStreaming||B.isStreaming,W=L.runStream;!function(e,t){let[n,r]=(0,f.useState)(!1),{activeOrganization:o}=(0,u.t)(),s=e?e.uuid:"",{mutate:i}=(0,a.W)(s),{mutate:l,error:c}=(0,a.j7)(s),p=(0,f.useRef)(!1);(0,f.useEffect)(()=>{var t;if(!c||(null==e?void 0:e.name))return;let n=(null==e?void 0:null===(t=e.chat_messages)||void 0===t?void 0:t[0])?(0,d.K)(e.chat_messages[0]):"";if(n){if(p.current)return;let e=n.slice(0,30),t=n.length>30?"...":"";p.current=!0,i({name:"\uD83D\uDCAC ".concat(e).concat(t)})}},[c,e,i]),(0,f.useEffect)(()=>{if(t||n||(null==e?void 0:e.name))return;let a=null==e?void 0:e.chat_messages;if(!a||a.length<2||0===(0,d.K)(a[1]).length)return;let s=["Message 1:",m((0,d.K)(a[0])),"Message 2:",m((0,d.K)(a[1]))].join("\n\n");o&&(r(!0),l({message_content:s,recent_titles:[]}))},[t,n,e,o,l])}(k,V),function(e){let{conversationUUID:t,isStreaming:n}=e,[r,a]=(0,f.useState)(n),{mcpClients:o}=(0,l.c)(),s=o.dolphin,i=!!s&&(0,g.Rx)();(0,f.useEffect)(()=>{i&&(!n&&r?(a(!1),s.notification({method:"notifications/progress",params:{progress:1,total:1,progressToken:"streaming"}})):!r&&n&&(s.notification({method:"notifications/progress",params:{progress:0,total:1,progressToken:"streaming"}}),a(!0)))},[t,i,n,r,s])}({conversationUUID:i,isStreaming:V});let G=(0,f.useCallback)(async(e,t)=>{var n;await W({prompt:t,attachments:e.attachments,files:null!==(n=e.files_v2)&&void 0!==n?n:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:Q})},[W,Q]),$=(0,f.useCallback)((e,t)=>{z(i,e,t,e=>F({current_leaf_message_uuid:e}))},[z,i,F]),ee=(0,r.jsx)("div",{className:"fixed inset-0 grid place-items-center",children:(0,r.jsx)(x.g,{})});if(y)return ee;if(!k){if(A||M)return ee;(0,s.notFound)()}return(0,r.jsxs)(v.I,{settings:k.settings||{},children:[(0,r.jsx)(j.J,{isStreaming:V,chatInputDefaultMessage:_,conversationTitle:o,conversationUUID:i,messages:w,name:null!==(n=null==k?void 0:k.name)&&void 0!==n?n:"Untitled Chat",onSend:L.runStream,onRetry:B.runStream,projectUuid:null==k?void 0:k.project_uuid,changeDisplayedConversationPath:$,editMessage:G,setPersonalizedStyleCallback:q,onToolAllow:P}),(0,r.jsx)(O,{isModalOpen:R,currentTool:U,currentToolInput:Z,handleDeny:Y,handleAllow:P,handleAlwaysAllow:H})]})}function P(e){let{data:t}=(0,a._C)(e.conversationUUID,{suppressError:!0}),n=(null==t?void 0:t.project_uuid)||"",{userHasHarmony:o,projectHasHarmony:s}=(0,_.Y)(n),[i,l]=(0,f.useState)(!!(o&&s)),c=(0,f.useCallback)(()=>l(!1),[]);return(0,r.jsx)(w.C,{projectUuid:n,onLoad:c,children:(0,r.jsx)(y.r,{children:(0,r.jsx)(Z,{...e,isLoadingHarmony:i})})})}function Y(e){var t;let{params:{uuid:n}}=e,l=(0,s.useSearchParams)(),c=null==l?void 0:l.get("q"),{data:u}=(0,a.QR)(),d=null==u?void 0:null===(t=u.find(e=>e.uuid===n))||void 0===t?void 0:t.name;return(0,o.ZQ)(null!=d?d:""),(0,r.jsx)(i.M,{conversationUUID:n,children:(0,r.jsx)(P,{conversationTitle:d?"".concat(d," - Claude"):"Claude",conversationUUID:n,chatInputDefaultMessage:null!=c?c:void 0})})}},22623:function(e,t,n){"use strict";function r(e){let t;try{t=JSON.parse(e)}catch(e){}return t}n.d(t,{I:function(){return r}})},6141:function(e,t,n){"use strict";n.d(t,{Q:function(){return k}});var r=n(91014),a=n(6482),o=n(57851),s=n(32751),i=n(7653),l=n(48970),c=n(70097),u=n(37029),d=n(97712);let m=d.z.object({path:d.z.string()});var f=n(79067),p=n(49456),h=n(71994);async function v(e,t){let n;try{n=await t.callback(e)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}return{is_error:n.isError,content:n.content.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return x({mimeType:e.mimeType,base64Data:e.data});case"resource":{let t=e.resource;if("text"in t)return{type:"text",text:t.text};if("blob"in t){if(!t.mimeType)throw Error("Missing MIME type for embedded resource");return x({mimeType:t.mimeType,base64Data:t.blob})}}}throw Error("Unsupported content type: ".concat(e.type))})}}function x(e){let{mimeType:t,base64Data:n}=e;if(!p.wI[t])throw Error("Unsupported image type: ".concat(t));let r=p.wI[t];return{type:"image",file_name:"".concat((0,h.H)(),".").concat(r),source:{media_type:t,type:"base64",data:n}}}var g=n(76505),y=n(61867);async function _(e,t){let n=y.KX.safeParse(e);if(n.success)try{let e=await t(n.data.code);return{content:[{type:"text",text:JSON.stringify(e)}]}}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}else throw Error("Error parsing input: ".concat(n.error.message))}var w=n(2550),j=n(1373);let b=d.z.object({path:d.z.string(),old_str:d.z.string(),new_str:d.z.string(),original_hash:d.z.string().optional()});var E=n(87689),C=n(74293),N=n(51087),S=n(22623),T=n(93456);function k(){let{mutateAsync:e}=(0,r.fc)(),t=function(){let{dispatchChatResource:e}=(0,T.Y)(),{files:t,projectDocs:n,projectUuid:r}=(0,N.b)(),{getInstance:s}=(0,C.s)(),{executeReplCode:d}=(0,a.M)(),{mcpTools:p}=(0,o.c)(),{mutateAsync:h}=(0,l.u3)(r),{mutateAsync:x}=(0,l.Zy)(r),{mutateAsync:y}=(0,l.ER)(r);return(0,i.useCallback)(async(a,o)=>{let i=(0,S.I)(o);switch(a){case"close_file":return await (0,c.h)(i,n,y);case"file_search":return await (0,f._)(i,r,t);case"str_replace":return function(e,t,n){let{path:r,old_str:a}=b.parse(e);if(!(0,j.Wx)(r))throw Error("Invalid path");let o=n(r);if(!o)throw Error("No open editor found for this path.");let s=(0,w.li)(o);if(!s.includes(a))throw Error("The string you want to replace does not exist in the file.");if(2!==s.split(a).length)throw Error("The string you want to replace must appear exactly once in the file. Please provide a unique match.");return t({type:"SELECT_SYNCED_DIRECTORY",id:r}),t({type:"OPEN_CHAT_SIDEBAR"}),{content:[{type:"text",text:"Successfully made one edit and showed it to the user for approval. The edit will not be saved to the filesystem until the user approves it and saves the change."}]}}(i,e,s);case"update_file":return(0,E.z)(i,e);case"open_file":return await (0,g.a)(i,n,r,h,x,e);case"create_file":return(0,u.E)(i,e);case"delete_file":return function(e,t){let{path:n}=m.parse(e);return t({type:"SELECT_SYNCED_DIRECTORY",id:n}),t({type:"OPEN_CHAT_SIDEBAR"}),{content:[{type:"text",text:"Successfully showed the file deletion to the user for approval. The file will not be deleted from the filesystem until the user approves the deletion."}]}}(i,e)}if("repl"===a)return await _(i,d);{let e=null==p?void 0:p.find(e=>e.name===a);if(e)return await v(i,e)}},[h,y,e,d,t,s,p,n,r,x])}();return(0,i.useCallback)(async function(n,r,a,o){let{overriddenResult:i}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};s.f("Tools: Using tool ".concat(r," with input ").concat(o));try{let l=null!=i?i:await t(r,o);if(void 0===l){s.f("Tools: Unable to find tool with name ".concat(r));return}s.f("Tools: Result for tool ".concat(r,": ").concat(l)),await e({conversation_uuid:n,type:"tool_result",tool_use_id:a,...l})}catch(o){let t=o instanceof Error?o.message:String(o);s.f("Tools: Error for tool ".concat(r,": ").concat(t)),await e({conversation_uuid:n,type:"tool_result",tool_use_id:a,content:[{type:"text",text:t}]})}},[t,e])}}},function(e){e.O(0,[4507,7926,2044,9906,7611,4408,5469,395,6659,4164,3124,3982,4128,9095,1359,8566,9261,6572,6088,2898,622,56,2177,6192,7712,2237,126,6398,9194,2862,6291,7991,2679,2545,8006,8039,1014,5667,9136,4293,2274,5765,6010,7718,8930,1181,4038,1293,1362,693,1744],function(){return e(e.s=53326)}),_N_E=e.O()}]);